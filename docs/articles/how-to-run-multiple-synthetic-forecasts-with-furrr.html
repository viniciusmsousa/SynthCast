<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How to Run Multiple Synthetic Forecasts with Furrr • SynthCast</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="How to Run Multiple Synthetic Forecasts with Furrr">
<meta property="og:description" content="SynthCast">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SynthCast</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/how-to-run-multiple-synthetic-forecasts-with-furrr.html">How to Run Multiple Synthetic Forecasts with Furrr</a>
    </li>
    <li>
      <a href="../articles/how-to-run-synthetic-forecast.html">How to Run a Synthetic Forecast</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="how-to-run-multiple-synthetic-forecasts-with-furrr_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>How to Run Multiple Synthetic Forecasts with Furrr</h1>
            
      
      
      <div class="hidden name"><code>how-to-run-multiple-synthetic-forecasts-with-furrr.Rmd</code></div>

    </div>

    
    
<p>This is a walk through of how the main package function <code><a href="../reference/run_synthetic_forecast.html">SynthCast::run_synthetic_forecast()</a></code> can be used with the <a href="https://furrr.futureverse.org/">furrr package</a>. The goal of furrr is to combine purrr’s family of mapping functions with future’s parallel processing capabilities. Therefore, the objective of this article is to show how you could run multiple forecasts in a parallel manner.</p>
<p>Please fell free to contribute if you think of a batter way to do so! If you want see an usage example of the function <code><a href="../reference/run_synthetic_forecast.html">SynthCast::run_synthetic_forecast()</a></code> see the article <a href="https://viniciusmsousa.github.io/SynthCast/articles/how-to-run-synthetic-forecast.html">How to Run a Synthetic Forecast</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org">future</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr">furrr</a></span><span class="op">)</span></code></pre></div>
<div id="the-dataset" class="section level4">
<h4 class="hasAnchor">
<a href="#the-dataset" class="anchor"></a>The Dataset</h4>
<p>The first thing that a forecast needs a data to be forecasted. The SynthCast provides a example of how it expected a dataset to look like, the code bellow loads the package and the example dataset:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://viniciusmsousa.github.io/SynthCast/">SynthCast</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">'df_example'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df_example</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<table class="table">
<colgroup>
<col width="1%">
<col width="4%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="1%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="1%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="1%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="1%">
<col width="3%">
<col width="3%">
</colgroup>
<thead><tr class="header">
<th align="right">unit</th>
<th align="right">time_period</th>
<th align="right">x1</th>
<th align="right">x2</th>
<th align="right">x3</th>
<th align="right">x4</th>
<th align="right">x5</th>
<th align="right">x6</th>
<th align="right">x7</th>
<th align="right">x8</th>
<th align="right">x9</th>
<th align="right">x10</th>
<th align="right">x11</th>
<th align="right">x12</th>
<th align="right">x13</th>
<th align="right">x14</th>
<th align="right">x15</th>
<th align="right">x16</th>
<th align="right">x17</th>
<th align="right">x18</th>
<th align="right">x19</th>
<th align="right">x20</th>
<th align="right">x21</th>
<th align="right">x22</th>
<th align="right">x23</th>
<th align="right">x24</th>
<th align="right">x25</th>
<th align="right">x26</th>
<th align="right">x27</th>
<th align="right">x28</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.4279268</td>
<td align="right">0.2329316</td>
<td align="right">0.4531898</td>
<td align="right">0.5010649</td>
<td align="right">0.0140657</td>
<td align="right">0.5</td>
<td align="right">0.0103704</td>
<td align="right">0.0126492</td>
<td align="right">0.0061209</td>
<td align="right">0.0016722</td>
<td align="right">0.0020701</td>
<td align="right">0.0229175</td>
<td align="right">0.1717596</td>
<td align="right">0.0028440</td>
<td align="right">0.2961483</td>
<td align="right">0.2777202</td>
<td align="right">0.0179579</td>
<td align="right">0.5</td>
<td align="right">0.0186335</td>
<td align="right">0.0196256</td>
<td align="right">0.0140659</td>
<td align="right">0.5</td>
<td align="right">0.0191083</td>
<td align="right">0.0193874</td>
<td align="right">0.0280014</td>
<td align="right">0.5</td>
<td align="right">0.0062926</td>
<td align="right">0.0193874</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.3923215</td>
<td align="right">0.0661752</td>
<td align="right">0.4300946</td>
<td align="right">0.4639223</td>
<td align="right">0.1523873</td>
<td align="right">0.5</td>
<td align="right">0.0167901</td>
<td align="right">0.1340623</td>
<td align="right">0.0940312</td>
<td align="right">0.0016722</td>
<td align="right">0.0063536</td>
<td align="right">0.0896040</td>
<td align="right">0.1362349</td>
<td align="right">0.0028440</td>
<td align="right">0.2961483</td>
<td align="right">0.2352990</td>
<td align="right">0.1657939</td>
<td align="right">0.5</td>
<td align="right">0.1428571</td>
<td align="right">0.1479287</td>
<td align="right">0.1589145</td>
<td align="right">0.5</td>
<td align="right">0.1974522</td>
<td align="right">0.1750037</td>
<td align="right">0.1949374</td>
<td align="right">0.5</td>
<td align="right">0.0181592</td>
<td align="right">0.1750037</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0.4420440</td>
<td align="right">0.1649872</td>
<td align="right">0.4336537</td>
<td align="right">0.5034269</td>
<td align="right">0.2919640</td>
<td align="right">0.5</td>
<td align="right">0.0395062</td>
<td align="right">0.2602215</td>
<td align="right">0.1796289</td>
<td align="right">0.0016722</td>
<td align="right">0.0137895</td>
<td align="right">0.1695727</td>
<td align="right">0.1045988</td>
<td align="right">0.0028440</td>
<td align="right">0.2961483</td>
<td align="right">0.2088865</td>
<td align="right">0.3180237</td>
<td align="right">0.5</td>
<td align="right">0.3167702</td>
<td align="right">0.2890312</td>
<td align="right">0.3442300</td>
<td align="right">0.5</td>
<td align="right">0.3949045</td>
<td align="right">0.3201550</td>
<td align="right">0.2198580</td>
<td align="right">0.5</td>
<td align="right">0.0167533</td>
<td align="right">0.3201550</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">4</td>
<td align="right">0.4545717</td>
<td align="right">0.1076923</td>
<td align="right">0.4433019</td>
<td align="right">0.5427364</td>
<td align="right">0.4315704</td>
<td align="right">0.5</td>
<td align="right">0.0501235</td>
<td align="right">0.3791298</td>
<td align="right">0.2685505</td>
<td align="right">0.0016722</td>
<td align="right">0.0172917</td>
<td align="right">0.2420208</td>
<td align="right">0.0822586</td>
<td align="right">0.0028440</td>
<td align="right">0.2961483</td>
<td align="right">0.1556901</td>
<td align="right">0.4694968</td>
<td align="right">0.5</td>
<td align="right">0.4223602</td>
<td align="right">0.4250857</td>
<td align="right">0.5346481</td>
<td align="right">0.5</td>
<td align="right">0.5859873</td>
<td align="right">0.4600435</td>
<td align="right">0.2291281</td>
<td align="right">0.5</td>
<td align="right">0.0072638</td>
<td align="right">0.4600435</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">5</td>
<td align="right">0.4223203</td>
<td align="right">0.1391912</td>
<td align="right">0.4767905</td>
<td align="right">0.5474351</td>
<td align="right">0.5673960</td>
<td align="right">0.5</td>
<td align="right">0.0501235</td>
<td align="right">0.4999604</td>
<td align="right">0.3522328</td>
<td align="right">0.1638796</td>
<td align="right">0.0279551</td>
<td align="right">0.3139178</td>
<td align="right">0.0689121</td>
<td align="right">0.2787148</td>
<td align="right">0.0835851</td>
<td align="right">0.1119981</td>
<td align="right">0.6177005</td>
<td align="right">0.5</td>
<td align="right">0.6149068</td>
<td align="right">0.5627327</td>
<td align="right">0.7247700</td>
<td align="right">0.5</td>
<td align="right">0.7834395</td>
<td align="right">0.5979929</td>
<td align="right">0.2351954</td>
<td align="right">0.5</td>
<td align="right">0.0072638</td>
<td align="right">0.5979929</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">6</td>
<td align="right">0.3827364</td>
<td align="right">0.1078405</td>
<td align="right">0.5021293</td>
<td align="right">0.5456524</td>
<td align="right">0.6992290</td>
<td align="right">0.5</td>
<td align="right">0.0688889</td>
<td align="right">0.6161397</td>
<td align="right">0.4334900</td>
<td align="right">0.3311037</td>
<td align="right">0.0335161</td>
<td align="right">0.3829171</td>
<td align="right">0.0602702</td>
<td align="right">0.2787148</td>
<td align="right">0.0835851</td>
<td align="right">0.0985164</td>
<td align="right">0.7600335</td>
<td align="right">0.5</td>
<td align="right">0.7826087</td>
<td align="right">0.6957559</td>
<td align="right">0.9102858</td>
<td align="right">0.5</td>
<td align="right">0.9745223</td>
<td align="right">0.7413431</td>
<td align="right">0.2458748</td>
<td align="right">0.5</td>
<td align="right">0.0072638</td>
<td align="right">0.7413431</td>
</tr>
</tbody>
</table>
<p>The dataset is expected to have 3 types of columns:</p>
<ul>
<li><ol style="list-style-type: decimal">
<li>
<em>A unit column</em>: containing a numeric identification of the unit. In the credit card example this could the the customer, a group of customer, etc.,;</li>
</ol></li>
<li><ol start="2" style="list-style-type: decimal">
<li>
<em>A time columns</em>: containing the time in integer. In the credit card example this would be the age in months of the respective unit (say 1 for first month, 2 for the second month, etc.,);</li>
</ol></li>
<li><ol start="3" style="list-style-type: decimal">
<li>
<em>Feature Columns</em>: Numeric features, with both the serie(s) that will be forecasted as well as features to use to forecast. In the credit card this could be the profitability and transactional features.</li>
</ol></li>
</ul>
</div>
<div id="setting-up-the-requirements" class="section level4">
<h4 class="hasAnchor">
<a href="#setting-up-the-requirements" class="anchor"></a>Setting Up the Requirements</h4>
<p>The solution that I present here consists of creating another dataset that will contain the parameters as columns and each row the combination of parameters.</p>
<p>So lets work with a practical example: Lets supose we want to forecasts 12 and 40 time periods for the units <code>30</code> and <code>40</code>, for the columns <code>x1</code> and <code>x3</code>.</p>
<div id="dataframe-with-parameters" class="section level5">
<h5 class="hasAnchor">
<a href="#dataframe-with-parameters" class="anchor"></a>Dataframe with Parameters</h5>
<p>The first thing that we need is a dataframe with the parameters as columns, with the exeception of the dataset itself:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R">

<span class="co">## parametros variaveis</span>
<span class="va">units_of_interest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">30</span>,<span class="fl">40</span><span class="op">)</span>
<span class="va">series_of_interest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'x1'</span>, <span class="st">'x3'</span><span class="op">)</span>
<span class="va">periods_to_forecast</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">20</span><span class="op">)</span> 

<span class="va">col_time</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'time_period'</span><span class="op">)</span>
<span class="va">col_unit_name</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'unit'</span><span class="op">)</span>
<span class="va">periods_to_forecast</span> <span class="op">=</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  unit_of_interest <span class="op">=</span> <span class="va">units_of_interest</span>,
  periods_to_forecast <span class="op">=</span> <span class="va">periods_to_forecast</span>
<span class="op">)</span>

<span class="va">crossArg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/cross.html">cross_df</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    unit_of_interest <span class="op">=</span> <span class="va">units_of_interest</span>,
    serie_of_interest <span class="op">=</span> <span class="va">series_of_interest</span>,
    col_time<span class="op">=</span><span class="va">col_time</span>,
    col_unit_name<span class="op">=</span><span class="va">col_unit_name</span>
  <span class="op">)</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">periods_to_forecast</span>, by<span class="op">=</span><span class="st">'unit_of_interest'</span><span class="op">)</span>

<span class="va">crossArg</span>
<span class="co">#&gt; # A tibble: 4 x 5</span>
<span class="co">#&gt;   unit_of_interest serie_of_interest col_time   col_unit_name periods_to_foreca…</span>
<span class="co">#&gt;              &lt;dbl&gt; &lt;chr&gt;             &lt;chr&gt;      &lt;chr&gt;                      &lt;dbl&gt;</span>
<span class="co">#&gt; 1               30 x1                time_peri… unit                          12</span>
<span class="co">#&gt; 2               40 x1                time_peri… unit                          20</span>
<span class="co">#&gt; 3               30 x3                time_peri… unit                          12</span>
<span class="co">#&gt; 4               40 x3                time_peri… unit                          20</span></code></pre></div>
</div>
<div id="wrapper-function" class="section level5">
<h5 class="hasAnchor">
<a href="#wrapper-function" class="anchor"></a>Wrapper Function</h5>
<p>The second thing that we need is to define a function that will wrap the <code><a href="../reference/run_synthetic_forecast.html">SynthCast::run_synthetic_forecast()</a></code>. This is done because in order to map over multiple parameters with the <code>furrr</code> package with need the parameters in a dataframe. But we cannot put a dataframe in a column, without using column lists.</p>
<p>Note that the object <code>df_example</code> that is called inside <code>f()</code> is a global parameter defined above. This is a workaround, but gets the job done.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">col_unit_name</span>, <span class="va">unit_of_interest</span>, <span class="va">col_time</span>, <span class="va">periods_to_forecast</span>, <span class="va">serie_of_interest</span><span class="op">)</span><span class="op">{</span>
  <span class="va">synth_forecast</span> <span class="op">=</span> <span class="fu">SynthCast</span><span class="fu">::</span><span class="fu"><a href="../reference/run_synthetic_forecast.html">run_synthetic_forecast</a></span><span class="op">(</span>
    df<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">df_example</span><span class="op">)</span>, <span class="co"># Global environment</span>
    col_unit_name<span class="op">=</span><span class="va">col_unit_name</span>,
    unit_of_interest<span class="op">=</span><span class="va">unit_of_interest</span>,
    col_time<span class="op">=</span><span class="va">col_time</span>,
    periods_to_forecast<span class="op">=</span><span class="va">periods_to_forecast</span>,
    serie_of_interest<span class="op">=</span><span class="va">serie_of_interest</span>
  <span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">synth_forecast</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
</div>
<div id="running-the-forecasts-parallelized" class="section level4">
<h4 class="hasAnchor">
<a href="#running-the-forecasts-parallelized" class="anchor"></a>Running the Forecasts Parallelized</h4>
<p>Setup the parallel backend, as indicated in the <code>furrr</code> documentation:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span> <span class="co"># Setup to use multiple core</span></code></pre></div>
<p>Now we can use the <code>furrr:future_pmap()</code> to run the forecasts:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">synthetic_forecasts</span> <span class="op">&lt;-</span> <span class="fu">furrr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map2.html">future_pmap</a></span><span class="op">(</span>
  <span class="va">crossArg</span>,
  <span class="va">f</span>
<span class="op">)</span>
<span class="co">#&gt; [1] "Forecasting Unit:  30 . Serie:  x1"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; X1, X0, Z1, Z0 all come directly from dataprep object.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt;  searching for synthetic control unit  </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSPE (LOSS V): 0.005105562 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; solution.v:</span>
<span class="co">#&gt;  0.03795838 0.02953412 0.03356642 0.01533716 0.1226315 0.1285906 0.05816525 0.02318678 0.01465216 0.01080646 0.06187415 0.0289542 0.01702719 0.08006876 0.009607601 0.01627082 0.1278952 0.02615566 0.01342692 0.04431671 0.04468165 0.01097563 0.04431671 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; solution.w:</span>
<span class="co">#&gt;  1.1452e-05 0.0002666085 0.0001873182 0.0002686277 0.0001636778 0.0003347625 0.0004905744 0.0005939929 0.0005203545 0.5502766 4.8739e-06 0.0007708196 0.0003844661 0.001002508 0.000803214 0.000999687 0.1285913 0.3143298 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [1] "Forecasting Unit:  40 . Serie:  x1"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; X1, X0, Z1, Z0 all come directly from dataprep object.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt;  searching for synthetic control unit  </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSPE (LOSS V): 0.01126689 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; solution.v:</span>
<span class="co">#&gt;  0.00451887 0.1198275 0.001215545 0.01511271 0.0005242874 0.0207889 0.1270972 0.03638089 0.1136289 0.07111816 0.06962764 0.03914189 0.00266398 0.003293383 0.003680319 0.002879397 0.0001513126 0.1898451 0.003094035 0.0532468 0.06650722 0.002409148 0.0532468 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; solution.w:</span>
<span class="co">#&gt;  2.892e-07 7.7e-09 8.85e-08 2.97e-08 2.778e-07 1.147e-07 1.083e-07 3.687e-07 1.0996e-06 6.876e-07 2.4978e-06 0.0002996523 0.00148343 0.4549331 0.0003138607 0.001220969 0.526065 0.0005761354 5.26296e-05 0.01504971 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [1] "Forecasting Unit:  30 . Serie:  x3"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; X1, X0, Z1, Z0 all come directly from dataprep object.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt;  searching for synthetic control unit  </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSPE (LOSS V): 0.004444729 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; solution.v:</span>
<span class="co">#&gt;  0.0008966688 0.05006106 0.04589722 0.01215437 0.1364756 0.1380885 0.07131376 0.02247537 0.06353448 0.001899661 0.05256282 0.02746854 0.02928654 0.06565559 0.001513901 0.01546533 0.1404815 0.008559098 0.0178953 0.02120212 0.04279917 0.01311125 0.02120212 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; solution.w:</span>
<span class="co">#&gt;  1.11103e-05 0.0004018295 0.000251307 0.0004156746 0.0002930494 0.0004620298 0.0007838085 0.001376503 0.0006554179 0.5237144 0.001810757 0.001349141 0.0005160587 0.002039712 0.001832605 0.002641334 0.03367259 0.4277733 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [1] "Forecasting Unit:  40 . Serie:  x3"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; X1, X0, Z1, Z0 all come directly from dataprep object.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt;  searching for synthetic control unit  </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; **************** </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSPE (LOSS V): 0.0003451711 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; solution.v:</span>
<span class="co">#&gt;  0.0838238 0.01402602 0.02662944 0.0001756046 0.08158252 0.04514179 0.03369849 0.0432683 0.04256028 0.01812175 5.0628e-05 0.04334514 0.1161261 0.0002120456 6.248e-05 0.01880793 0.05472154 0.03005398 1.5966e-06 0.142656 0.0129223 0.04935617 0.142656 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; solution.w:</span>
<span class="co">#&gt;  4.158e-07 1.9116e-06 4.2001e-06 3.7943e-06 0.05303326 0.02782933 0.0003817437 1.66687e-05 1.06607e-05 4.89541e-05 8.04749e-05 3.8502e-06 8.695e-07 0.6799389 2.1e-08 3.14e-06 0.001466123 0.151224 0.08586669 8.49833e-05</span></code></pre></div>
<p>The <code>synthetic_forecasts</code> object is a list of output from <code><a href="../reference/run_synthetic_forecast.html">SynthCast::run_synthetic_forecast()</a></code>.</p>
</div>
<div id="bind-result-tables" class="section level4">
<h4 class="hasAnchor">
<a href="#bind-result-tables" class="anchor"></a>Bind Result Tables</h4>
<p>We can now bind the tables from the different forecasts together:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mape_backtest</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">synthetic_forecasts</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">mape_backtest</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">mape_backtest</span><span class="op">)</span> </code></pre></div>
<table class="table">
<colgroup>
<col width="10%">
<col width="10%">
<col width="10%">
<col width="17%">
<col width="13%">
<col width="15%">
<col width="14%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left">execution_date</th>
<th align="left">projected_unit</th>
<th align="left">projected_serie</th>
<th align="right">max_time_unit_of_interest</th>
<th align="right">periods_to_forecast</th>
<th align="right">elegible_control_units</th>
<th align="right">number_control_units</th>
<th align="right">mape</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2022-03-08</td>
<td align="left">30</td>
<td align="left">x1</td>
<td align="right">21</td>
<td align="right">12</td>
<td align="right">17</td>
<td align="right">9</td>
<td align="right">13.009279</td>
</tr>
<tr class="even">
<td align="left">2022-03-08</td>
<td align="left">40</td>
<td align="left">x1</td>
<td align="right">11</td>
<td align="right">20</td>
<td align="right">19</td>
<td align="right">6</td>
<td align="right">21.482920</td>
</tr>
<tr class="odd">
<td align="left">2022-03-08</td>
<td align="left">30</td>
<td align="left">x3</td>
<td align="right">21</td>
<td align="right">12</td>
<td align="right">17</td>
<td align="right">12</td>
<td align="right">7.898514</td>
</tr>
<tr class="even">
<td align="left">2022-03-08</td>
<td align="left">40</td>
<td align="left">x3</td>
<td align="right">11</td>
<td align="right">20</td>
<td align="right">19</td>
<td align="right">6</td>
<td align="right">3.090236</td>
</tr>
</tbody>
</table>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Vinicius Sousa.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
